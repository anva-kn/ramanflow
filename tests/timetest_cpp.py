import timeit
import sys
sys.path.insert(1, '../utils')
sys.path.insert(1, '../models')
#import matplotlib
# matplotlib.use('Qt5Agg')
import matplotlib.pyplot as plt
import numpy as np
#from fit_functions import Fit
from loss_functions import Loss
from peak import Peak
from fit import Fit
# TODO: merge once done


x_rec_1 = np.array([627.46015569, 629.34225422, 631.2241628, 633.10588144,
                    634.98741013, 636.86874887, 638.74989766, 640.6308565,
                    642.5116254, 644.39220435, 646.25916268, 648.13936309,
                    650.01937355, 651.89919407, 653.77882464, 655.65826526,
                    657.52409339, 659.40315547, 661.28202761, 663.16070979,
                    665.02578491, 666.90408856, 668.78220226, 670.64671294,
                    672.52444811, 674.38858296, 676.26593959, 678.14310627,
                    680.00667669, 681.88346483, 683.74665943, 685.62306903,
                    687.48588779, 689.3485193, 691.22436177, 693.08661746,
                    694.96208139, 696.82396124, 698.68565384, 700.5471592,
                    702.42186741, 704.28299694, 706.14393922, 708.00469425,
                    709.87864675, 711.73902595, 713.59921791, 715.45922263,
                    717.3190401, 719.17867033, 721.03811331, 722.89736905,
                    724.75643755, 726.6153188, 728.47401281, 730.33251958,
                    732.1908391, 734.04897138, 735.90691641, 737.7646742,
                    739.6088816, 741.46626625, 743.32346366, 745.18047382,
                    747.03729674, 748.880576, 750.73702578, 752.59328831,
                    754.43601122, 756.29190061, 758.13425306, 759.98976931,
                    761.84509832, 763.68689442, 765.54185029, 767.38327593,
                    769.23785866, 771.07891384, 772.91978446, 774.77380815,
                    776.61430832, 778.45462393, 780.30808859, 782.14803374,
                    783.98779433, 785.84069995, 787.68009009, 789.51929566,
                    791.35831668, 793.19715314, 795.03580504, 796.88759393,
                    798.72587538, 800.56397226, 802.40188459, 804.23961235,
                    806.07715556, 807.91451421, 809.7383761, 811.57536697,
                    813.41217328, 815.24879503, 817.08523222, 818.92148485,
                    820.75755292, 822.58013359, 824.41583388, 826.25134961,
                    828.07338194, 829.90852989, 831.74349328, 833.56497728,
                    835.39957289, 837.22069177, 839.05491959, 840.87567336,
                    842.70953341, 844.52992205, 846.36341432, 848.18343785,
                    850.00327949, 851.83622075, 853.65569727, 855.4749919,
                    857.30738216, 859.12631167, 860.94505929, 862.76362502,
                    864.59528105, 866.41348166, 868.23150037, 870.04933719,
                    871.86699212, 873.68446515, 875.50175629, 877.31886553,
                    879.13579288, 880.95253833, 882.76910189, 884.58548356,
                    886.38842706, 888.20444626, 890.02028357, 891.83593899,
                    893.65141252, 895.4534545, 897.26856556, 899.08349473,
                    900.88499633, 902.69956304, 904.50070483, 906.31490908,
                    908.11569105, 909.92953284, 911.729955, 913.54343432,
                    915.34349667, 917.15661353, 918.95631606, 920.75583934,
                    922.56841318, 924.36757665, 926.16656086, 927.96536583,
                    929.76399155, 931.57566123, 933.37392714, 935.17201379,
                    936.9699212, 938.76764936, 940.56519827, 942.36256794,
                    944.15975835, 945.95676952, 947.75360143, 949.5502541,
                    951.34672752, 953.12981431, 954.92593055, 956.72186754,
                    958.51762529, 960.30000165, 962.09540222, 963.89062354,
                    965.67246742, 967.46733156, 969.24882089, 971.04332785,
                    972.82446263, 974.61861242, 976.39939264, 978.19318524,
                    979.97361092, 981.75385997, 983.54711746, 985.32701196,
                    987.10672984, 988.89945223, 990.67881555, 992.45800225,
                    994.23701234, 996.01584579, 997.79450263, 999.57298285,
                    1001.35128644, 1003.12941341, 1004.90736376, 1006.68513748,
                    1008.46273459, 1010.24015507, 1012.01739893, 1013.79446617,
                    1015.57135678, 1017.33491058, 1019.11144926, 1020.88781132,
                    1022.65084047, 1024.4268506, 1026.20268409, 1027.96518861,
                    1029.74067017, 1031.50282535, 1033.27795498, 1035.03976084,
                    1036.81453853, 1038.57599505, 1040.33727757, 1042.11152801,
                    1043.87246119, 1045.63322036, 1047.39380551, 1049.16735338,
                    1050.92758921, 1052.68765101, 1054.44753881, 1056.20725258,
                    1057.96679234, 1059.72615809, 1061.48534982, 1063.24436754,
                    1065.00321124, 1066.76188092, 1068.52037659, 1070.26557709,
                    1072.02372603, 1073.78170095, 1075.53950186, 1077.28401278,
                    1079.04146696, 1080.79874712, 1082.54274118, 1084.29967461,
                    1086.04332452, 1087.79991122, 1089.54321699, 1091.29945695,
                    1093.04241858, 1094.78520878, 1096.54092929, 1098.28337535,
                    1100.02564997, 1101.78085104, 1103.52278152, 1105.26454058,
                    1107.00612821, 1108.7475444, 1110.48878918, 1112.22986252,
                    1113.97076444, 1115.71149492, 1117.45205398, 1119.19244162,
                    1120.93265782, 1122.6727026, 1124.41257595, 1126.13919805,
                    1127.87872983, 1129.61809019, 1131.34420315, 1133.08322194,
                    1134.8220693, 1136.54767312, 1138.28617892, 1140.01144374,
                    1141.74960797, 1143.4745338, 1145.19929077, 1146.93694329,
                    1148.66136126, 1150.38561037, 1152.12275119, 1153.8466613,
                    1155.57040255, 1157.29397494, 1159.01737848, 1160.74061315,
                    1162.46367896, 1164.18657592, 1165.90930401, 1167.63186325,
                    1169.35425362, 1171.07647514, 1172.7985278, 1174.5204116,
                    1176.24212653, 1177.95063123, 1179.67200973, 1181.39321937,
                    1183.10122259, 1184.82209579, 1186.52976513, 1188.25030189,
                    1189.95763733, 1191.67783765, 1193.38483921, 1195.10470309,
                    1196.81137075, 1198.5178721, 1200.23723196, 1201.94339942,
                    1203.64940057, 1205.35523541, 1207.06090394, 1208.76640616,
                    1210.47174207, 1212.17691167, 1213.88191495, 1215.58675193,
                    1217.29142259, 1218.99592695, 1220.70026499, 1222.40443673,
                    1224.10844215, 1225.79927548, 1227.50294955, 1229.20645731,
                    1230.89679679, 1232.5999732, 1234.28998385, 1235.9928289])

y_rec_1 = np.array([0.28264082, 0.28543594, 0.28201125, 0.2683669, 0.26334206,
                  0.26413072, 0.25774831, 0.2504032, 0.24311409, 0.24170359,
                  0.23715267, 0.23341834, 0.22191597, 0.22334994, 0.2229101,
                  0.22394291, 0.21681294, 0.21079558, 0.20740228, 0.20751322,
                  0.21056701, 0.20835484, 0.20492763, 0.20383226, 0.21312141,
                  0.2165535, 0.22174136, 0.23054197, 0.23129631, 0.22069009,
                  0.22163906, 0.22112236, 0.23450649, 0.23678239, 0.24574986,
                  0.24967181, 0.24689295, 0.25086422, 0.25169109, 0.25332577,
                  0.24467427, 0.24590975, 0.23836169, 0.23244152, 0.22641692,
                  0.214056, 0.20797547, 0.19892476, 0.1918973, 0.19176734,
                  0.18803472, 0.17908328, 0.17604118, 0.1693063, 0.1614371,
                  0.15386655, 0.14706649, 0.1378258, 0.13611101, 0.13824118,
                  0.13347368, 0.13830343, 0.12569735, 0.11916603, 0.11561261,
                  0.10668473, 0.10367313, 0.10777456, 0.10207042, 0.09763863,
                  0.10013245, 0.09592132, 0.09602734, 0.0976115, 0.09742241,
                  0.09625274, 0.09633581, 0.09507682, 0.08967802, 0.09035095,
                  0.09208228, 0.09277209, 0.08711383, 0.08501973, 0.08939797,
                  0.09195746, 0.09781263, 0.09017497, 0.09269715, 0.09010078,
                  0.08890753, 0.08288504, 0.08430435, 0.07885215, 0.07779186,
                  0.07790591, 0.08836332, 0.09208097, 0.0905811, 0.09022983,
                  0.09582936, 0.09743656, 0.09553492, 0.0938138, 0.0964457,
                  0.09382269, 0.09980769, 0.09994746, 0.09922418, 0.10194112,
                  0.10347874, 0.10597703, 0.10229299, 0.09446592, 0.093387,
                  0.09355265, 0.09807873, 0.10389156, 0.1111535, 0.12875211,
                  0.11917719, 0.11207794, 0.11279921, 0.11762805, 0.12384718,
                  0.12878655, 0.13830549, 0.14764328, 0.16246952, 0.1541414,
                  0.16830733, 0.17996213, 0.19927854, 0.21320715, 0.23845402,
                  0.26291993, 0.28890504, 0.32409518, 0.37257788, 0.42575621,
                  0.49214698, 0.57855998, 0.65787048, 0.74407683, 0.8327586,
                  0.91250507, 0.96933739, 1., 0.99336723, 0.95405721,
                  0.88749795, 0.81876539, 0.75850756, 0.7087704, 0.69606481,
                  0.69985628, 0.72783424, 0.76605688, 0.78856575, 0.77927253,
                  0.74179829, 0.66675015, 0.58028542, 0.49384853, 0.41252563,
                  0.34259096, 0.29045247, 0.24801977, 0.22719309, 0.21036438,
                  0.1918527, 0.17286988, 0.16216249, 0.15234459, 0.15203761,
                  0.14494801, 0.14092286, 0.13451053, 0.12429628, 0.13596959,
                  0.10903253, 0.10541689, 0.10522092, 0.09831404, 0.08265217,
                  0.0758039, 0.0728839, 0.06959544, 0.06761515, 0.06962798,
                  0.06838703, 0.06385639, 0.06235943, 0.06066268, 0.05900867,
                  0.05482611, 0.05193328, 0.05525134, 0.05370175, 0.05137693,
                  0.05210683, 0.05068044, 0.05119226, 0.05197724, 0.06271208,
                  0.05939985, 0.05550931, 0.05285392, 0.0558483, 0.05592289,
                  0.05371061, 0.05387454, 0.05939646, 0.06381537, 0.06919307,
                  0.06681808, 0.0717628, 0.0784854, 0.0848629, 0.08986914,
                  0.08953483, 0.09395576, 0.09718878, 0.11319998, 0.13657162,
                  0.14541671, 0.16303466, 0.18402624, 0.20936857, 0.2330305,
                  0.24548369, 0.25671401, 0.2706536, 0.26861244, 0.2723139,
                  0.26959058, 0.27608173, 0.27755501, 0.26981105, 0.26106006,
                  0.24763235, 0.22619351, 0.20546616, 0.17574864, 0.15394451,
                  0.13566113, 0.12081264, 0.11354557, 0.10338421, 0.0987398,
                  0.0992152, 0.09446244, 0.08321455, 0.08669098, 0.08886669,
                  0.08838253, 0.08588703, 0.09525193, 0.09090226, 0.08770822,
                  0.08678514, 0.0949587, 0.09825138, 0.10406261, 0.10986654,
                  0.11438136, 0.12054345, 0.12115304, 0.12394489, 0.12650238,
                  0.13788931, 0.1490323, 0.15455347, 0.15292248, 0.15696802,
                  0.16373879, 0.1695132, 0.17218108, 0.17057665, 0.17415216,
                  0.17965108, 0.18706008, 0.18668426, 0.18573812, 0.18534471,
                  0.18784348, 0.18868064, 0.19224737, 0.18956593, 0.19024837,
                  0.18309573, 0.173163, 0.16614249, 0.16524202, 0.15860037,
                  0.16235681, 0.13943584, 0.13751466, 0.13007514, 0.12466805,
                  0.1169458, 0.10766847, 0.10188885, 0.0988495, 0.09642287,
                  0.09071591, 0.08623268, 0.08219457, 0.07826609, 0.07300348,
                  0.0685473, 0.06465344, 0.06320822, 0.06334243, 0.0688003,
                  0.05688814, 0.05222684, 0.0521575, 0.04714542, 0.04700217,
                  0.04603207, 0.04593386, 0.04556077, 0.04490519, 0.04547559,
                  0.04419511, 0.04230284, 0.04086603, 0.04308731, 0.04245497,
                  0.04312914, 0.04669312, 0.04578797, 0.04701642, 0.04646649,
                  0.04853982, 0.05577773, 0.06387792, 0.05685955, 0.06036394])

myFit = Fit() 
starttime = timeit.default_timer()
print("The start time is :",starttime)
peak_1 = Peak(myFit.pseudo_voight_cpp, myFit.init_pseudo_voight_cpp, Loss.peak_mse_loss)

# peak_2 = Peak("peak 2", Fit.pseudo_voig, Fit.init_pseudo_voig, Loss.peak_mse_loss)
#
# peak_3 = Peak("peak 3", Fit.pseudo_voig, Fit.init_pseudo_voig, Loss.peak_mse_loss)

peak_1.init(x_rec_1, y_rec_1)

# peak_2.init(x_rec_2, y_rec_2)
#
# peak_3.init(x_rec_3, y_rec_3)


y_hat_1 = peak_1.fit(x_rec_1, y_rec_1)

print("The time difference is :", timeit.default_timer() - starttime)
